<div class="client">

  <div class="container">
    <form class="pjax" method="POST">
      <fieldset class="clearfix">
        <div class="column">
          <div class="form-field">
            <label>Company name</label>
            <input name="client[name]" value="<?=$client->name?>" type="text">
          </div>
          <div class="form-field">
            <label>Cellphone</label>
            <input name="client[cell]" value="<?=$client->cell?>" type="text">
          </div>
          <div class="form-field">
            <label>Telephone</label>
            <input name="client[tel]" value="<?=$client->tel?>" type="text">
          </div>
          <div class="form-field field-md">
            <label>Email</label>
            <input name="client[email]" value="<?=$client->email?>" type="email">
          </div>
          <div class="form-field field-md">
            <label>Website</label>
            <input name="client[website]" value="<?=$client->website?>" type="text">
          </div>
        </div>
        <div class="column">
          <div class="form-field">
            <label>Account no.</label>
            <input name="client[acc_no]" value="<?=$client->acc_no?>" type="text">
          </div>
          <div class="form-field">
            <label>Contact Firstname</label>
            <input name="client[contact_firstname]" value="<?=$client->contact_firstname?>" type="text">
          </div>
          <div class="form-field">
            <label>Contact Lastname</label>
            <input name="client[contact_lastname]" value="<?=$client->contact_lastname?>" type="text">
          </div>
          <div class="form-field">
            <label>ID regex</label>
            <textarea name="client[regex]" rows="3"><?=$client->regex?></textarea>
          </div>
        </div>
        <div class="row">
          <button type="submit" name="update-client">Update client</button>
        </div>
      </fieldset>
    </form>
  </div>
  
  <div class="container" style="margin-top:1em">
    <div class="action-bar text-right">
      <button type="button" onclick="F1.modal.show('#add-template', event, 'reset')">+ Add recurring invoice</button>
    </div>
    <?php foreach ($templates as $index => $template): ?>
    <div class="card container">
      <table class="invoices">
        <tbody>
          <tr>
            <td><b>Recurring Invoice <?=$template->id?></b><br><?=$template->name?></td>
            <td><b>Note</b><br><?=$template->description?></td>
            <td><b>Sart</b><br><?=substr($template->start_date,0,10)?></td>
            <td><b>Expire</b><br><?=substr($template->expire_date,0,10)?></td>
            <td><b>Billing Period</b><br><?=array_get($billingPeriods, $template->billing_period_id)?></td>
            <td><?=$template->vat_invoice?'VAT':'NoVAT'?></td>
            <td>
              <a class="pagelink"
                href="invoice-templates/invoice-template/edit?client=<?=$client_id?>&amp;id=<?=$template->id?>">
                  Edit Invoice
              </a>
            </td>
          </tr>
        </tbody>
      </table>
      <table class="invoice-items">
        <thead>
          <tr>
            <th>Item Code</th>
            <th>Description</th>
            <th class="text-center">Unit Price</th>
            <th class="text-center">Qty</th>
            <th class="text-center">% Disc.</th>
            <th class="text-right">Line Total</th>
          </tr>
        </thead>
        <tbody>
          <?php foreach ($template->items?:[] as $item): ?>

          <tr>
            <td><?=$item->code?></td>
            <td><?=$item->name?></td>
            <td class="text-center"><?=Format::currency($item->cost_price, 0, 2)?></td>
            <td class="text-center"><?=$item->quantity?></td>
            <td class="text-center"><?=$item->percent_discount?></td>
            <td class="text-right"><?=Format::currency($item->cost_price * $item->quantity, 0, 2)?></td>
          </tr>
          <?php endforeach; ?>
          <?php if (empty($template->items)):?>
          
          <tr><td colspan="6">- None -</td></tr>
          <?php else: ?>
          
          <tr class="subtotal">
            <td colspan="3">&nbsp;</td>
            <td class="text-right" colspan="2">Subtotal</td>
            <td class="text-right"><?=Format::currency($template->totals->subtotal, 0, 2)?></td>
          </tr>
          <tr>
            <td colspan="3">&nbsp;</td>
            <td class="text-right" colspan="2"><em>VAT @ <?=$app->VAT?>%</em></td>
            <td class="text-right"><em><?=Format::currency($template->totals->vat, 'n/a', 2)?></em></td>
          </tr>
          <tr>
            <td colspan="3">&nbsp;</td>
            <td class="text-right" colspan="2"><b>Grand Total<b></td>
            <td class="text-right"><b><?=Format::currency($template->totals->grandTotal, 0, 2)?></b></td>
          </tr>          
          <?php endif; ?>          
        </tbody>
      </table>
    </div>
    <?php endforeach; ?>
    <?php if (empty($templates)):?>
    
    <div class="card">- None -</div>
    <?php endif; ?>
  </div>

  <!-- NEW INVOICE TEMPLATE MODAL -->
  <div id="add-template" class="modal hidden">
    <form method="POST" class="pjax">
      <div class="modal-inner">
        <header>
          <a class="modal-close" href="#" onclick="F1.modal.dismiss(this, event)">Close X</a>
        </header>
        <br>
        <div class="modal-content">
          <fieldset>
            <legend>Add New Invoice Template</legend>
            <div class="form-field">
              <label>Invoice Title</label>
              <input name="template[name]" value="" type="text">
            </div>
            <div class="form-field">
              <label>Description</label>
              <textarea name="template[description]" rows="2"></textarea>
            </div>
          </fieldset>
        </div>
        <br>
        <footer>
          <div class="buttons-bar">
            <button type="submit" name="add-template">Add template</button>
          </div>
        </footer>
      </div>
    </form>
  </div>
  
</div>
